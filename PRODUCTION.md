# Подготовка к продакшену

## Выполненные оптимизации

### 1. Очистка неиспользуемых файлов
- ✅ Удалены все тестовые скрипты (17 файлов)
- ✅ Удалены неиспользуемые компоненты UI
- ✅ Удалены неиспользуемые API endpoints

### 2. Оптимизация логирования
- ✅ Создана утилита `logger.ts` для управления логами
- ✅ Логи автоматически отключаются в продакшене
- ✅ Заменены все `console.log` на `logger.log` в основных файлах
- ✅ Критические ошибки продолжают логироваться

### 3. Оптимизация кода
- ✅ Удалены неиспользуемые импорты
- ✅ Оптимизирована загрузка заказов
- ✅ Улучшена обработка ошибок

## Переменные окружения

Создайте файл `.env` с следующими переменными:

```env
# База данных
DATABASE_URL="postgresql://user:password@localhost:5432/store_courier"

# JWT
JWT_SECRET="your-super-secret-jwt-key"

# Telegram Bot
TELEGRAM_BOT_TOKEN="your-bot-token-from-botfather"
TELEGRAM_BOT_USERNAME="your_bot_username"

# Next.js
NODE_ENV="production"
```

## Сборка для продакшена

```bash
# Установка зависимостей
npm install

# Генерация Prisma Client
npx prisma generate

# Миграции базы данных
npx prisma migrate deploy

# Сборка проекта
npm run build

# Запуск в продакшене
npm start
```

## Рекомендации для продакшена

### 1. База данных
- Используйте PostgreSQL в продакшене
- Настройте регулярные бэкапы
- Используйте connection pooling (например, PgBouncer)

### 2. Безопасность
- Используйте HTTPS
- Настройте CORS правильно
- Регулярно обновляйте зависимости
- Используйте сильные JWT секреты

### 3. Производительность
- Настройте CDN для статических файлов
- Используйте Redis для кэширования
- Оптимизируйте изображения
- Настройте compression middleware

### 4. Мониторинг
- Настройте логирование ошибок (например, Sentry)
- Мониторьте производительность
- Настройте уведомления о критических ошибках

### 5. Масштабирование
- Используйте PM2 или Docker для управления процессами
- Настройте load balancer
- Используйте горизонтальное масштабирование при необходимости

## Структура логирования

Логи автоматически отключаются в продакшене (`NODE_ENV=production`):
- `logger.log()` - отключается в продакшене
- `logger.error()` - отключается в продакшене
- `logger.warn()` - отключается в продакшене
- `criticalLogger.error()` - работает всегда (для критических ошибок)

## Проверка перед деплоем

- [ ] Все тесты проходят
- [ ] Нет ошибок линтера
- [ ] Переменные окружения настроены
- [ ] База данных мигрирована
- [ ] JWT секрет изменен
- [ ] Telegram bot token настроен
- [ ] CORS настроен правильно
- [ ] HTTPS настроен

## Деплой

### Vercel (рекомендуется)
```bash
# Установка Vercel CLI
npm i -g vercel

# Деплой
vercel --prod
```

### Docker
```bash
# Сборка образа
docker build -t store-courier .

# Запуск контейнера
docker run -p 3000:3000 --env-file .env store-courier
```

### PM2
```bash
# Установка PM2
npm install -g pm2

# Запуск приложения
pm2 start npm --name "store-courier" -- start

# Сохранение конфигурации
pm2 save

# Автозапуск при перезагрузке
pm2 startup
```

## Поддержка

При возникновении проблем проверьте:
1. Логи приложения
2. Логи базы данных
3. Логи Telegram бота
4. Переменные окружения
5. Версии зависимостей

